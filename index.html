<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Soalat_Test_School</title>

<!-- Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„Ø§Øª -->
<script src="questions.js"></script>

<!-- Ø§ÙÚ©Øª ØªØ´ÙˆÛŒÙ‚ÛŒ -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  font-family:tahoma;
  background:#f4f6f8;
  text-align:center;
}
.box{
  background:#fff;
  padding:20px;
  margin:20px auto;
  width:90%;
  max-width:500px;
  border-radius:10px;
}
button{
  padding:10px 20px;
  font-size:16px;
  margin:6px;
  cursor:pointer;
}
#timer{
  color:red;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ -->
<div class="box" id="startBox">
  <h2>Ø¢Ø²Ù…ÙˆÙ† Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
  <p>Ù…ÙˆØ¶ÙˆØ¹: ØªØ§Ø±ÛŒØ® Ùˆ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒ Ø§ÛŒØ±Ø§Ù†</p>
  <input id="name" placeholder="Ù†Ø§Ù… Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡">
  <br><br>
  <button onclick="startExam()">Ø´Ø±ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ†</button>
</div>

<!-- ØµÙØ­Ù‡ Ø¢Ø²Ù…ÙˆÙ† -->
<div class="box" id="examBox" style="display:none">
  <p>â± Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: <span id="timer">03:00</span></p>
  <h3 id="q"></h3>
  <div id="opts"></div>
</div>

<!-- ØµÙØ­Ù‡ Ù¾Ø§ÛŒØ§Ù† -->
<div class="box" id="endBox" style="display:none">
  <h2 id="result"></h2>
  <button onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
  <p>Ø·Ø±Ø§Ø­: aminsystem2000</p>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwVTHZnri3-2fi_ZMngnNqCYAASQ37k2UGtFvwrM_LORpPBfsn6DyjjALWeWgQYCrOf3g/exec";
const TOKEN = "Amin12368secure";

let qs = [];
let i = 0;
let score = 0;
let time = 180;
let timer;

function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}

function startExam(){
  const n = document.getElementById("name").value.trim();
  if(!n){
    alert("Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
    return;
  }

  // ğŸ”¹ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³ÙˆØ§Ù„Ø§Øª
  qs = shuffle(HISTORY).slice(0,4)
        .concat(shuffle(GEOGRAPHY).slice(0,4))
        .concat(shuffle(MIXED).slice(0,2));

  qs = shuffle(qs);

  document.getElementById("startBox").style.display="none";
  document.getElementById("examBox").style.display="block";

  showQ();
  startTimer();
}

function startTimer(){
  timer = setInterval(()=>{
    let m = Math.floor(time/60);
    let s = time % 60;
    document.getElementById("timer").innerText =
      ${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')};
    time--;
    if(time < 0){
      clearInterval(timer);
      finish();
    }
  },1000);
}

function showQ(){
  if(i >= qs.length){
    finish();
    return;
  }

  document.getElementById("q").innerText = qs[i].q;

  const options = shuffle([...qs[i].a]);
  document.getElementById("opts").innerHTML =
    options.map(o =>
      <button onclick="answer('${o}')">${o}</button>
    ).join("<br>");
}

function answer(x){
  if(x === qs[i].c) score++;
  i++;
  showQ();
}

function finish(){
  clearInterval(timer);
  document.getElementById("examBox").style.display="none";
  document.getElementById("endBox").style.display="block";

  document.getElementById("result").innerText =
    Ù†Ù…Ø±Ù‡ Ø´Ù…Ø§: ${score} Ø§Ø² 10;

  if(score === 10){
    confetti({spread:180,particleCount:150});
  }

  fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify({
      token:TOKEN,
      name:document.getElementById("name").value,
      score:score
    })
  });
}
</script>

</body>
</html>
